#!/usr/bin/env bash
# MJ Unified Benchmark Runner + Google Sync

set -euo pipefail

CSV_FILE="$HOME/MJ_benchmarks.csv"
SPECS_TMP="$HOME/.device_specs_tmp.csv"
BENCH_TMP="$HOME/.bench_results_tmp.csv"

GOOGLE_SHEET_ID="PUT_YOUR_SHEET_ID_HERE"
GOOGLE_DRIVE_FOLDER_ID="PUT_YOUR_DRIVE_FOLDER_ID_HERE"

echo "Collecting device specs..."
bash "$HOME/device_specs_to_csv.sh" --output "$SPECS_TMP"

echo "Running benchmark suite..."
python3 "$HOME/MJ_pipeline.py" --output "$BENCH_TMP"

if [ ! -f "$CSV_FILE" ]; then
    echo "Creating master CSV..."
    echo "Brand & Model,Launch Date,Price,CPU & Performance,Codename,CPU Speed,x86-64 Level,GPU,AI & NPU,RAM & Storage,Connectivity,Audio Ports,NFC & Wallet,Battery,Power & Charging,Qi Wireless Charging,Form Factor,Dimensions & Weight,Display,Build & Durability,Cameras,Biometrics & Health,Regional,Software & Updates,Color,Upgrade Options,Ecosystem Lock-in,Wear Detection,Touch Control,Storage Case,Special Features,Official Site,Info Links,BIOS/Boot Key,7-Zip MIPS,OpenSSL MB/s,RAMspeed MB/s,fio Seq Read MB/s,fio Seq Write MB/s,fio Rand Read IOPS,fio Rand Write IOPS,glmark2 Score,Kernel Build Time (s),Speedometer 2.1 Score,JetStream 2.2 Score,MotionMark 1.3 Score,Battery Full Capacity (Wh),Battery Design Capacity (Wh),Battery Health (%),Battery Cycle Count,Notes" > "$CSV_FILE"
fi

echo "Merging results..."
ROW="$(cat "$SPECS_TMP"),$(cat "$BENCH_TMP")"
echo "$ROW" >> "$CSV_FILE"

rm -f "$SPECS_TMP" "$BENCH_TMP"

echo "Syncing to Google Drive + Google Sheets..."
python3 "$HOME/sync_to_google.py" \
    --csv "$CSV_FILE" \
    --sheet "$GOOGLE_SHEET_ID" \
    --drive-folder "$GOOGLE_DRIVE_FOLDER_ID"

echo "âœ… Benchmark synced to cloud."